#!/usr/bin/ruby

class Circle(x,y,r) {
   method to_s { "Circle(#{x}, #{y}, #{r})" };
}

func solve_apollonius(Array c, Array s) -> Circle {

    var ğ‘£11 = (2*c[1].x - 2*c[0].x);
    var ğ‘£12 = (2*c[1].y - 2*c[0].y);
    var ğ‘£13 = (c[0].x**2 - c[1].x**2 + c[0].y**2 - c[1].y**2 - c[0].r**2 + c[1].r**2);
    var ğ‘£14 = (2*s[1]*c[1].r - 2*s[0]*c[0].r);

    var ğ‘£21 = (2*c[2].x - 2*c[1].x);
    var ğ‘£22 = (2*c[2].y - 2*c[1].y);
    var ğ‘£23 = (c[1].x**2 - c[2].x**2 + c[1].y**2 - c[2].y**2 - c[1].r**2 + c[2].r**2);
    var ğ‘£24 = (2*s[2]*c[2].r - 2*s[1]*c[1].r);

    var ğ‘¤12 = (ğ‘£12 / ğ‘£11);
    var ğ‘¤13 = (ğ‘£13 / ğ‘£11);
    var ğ‘¤14 = (ğ‘£14 / ğ‘£11);

    var ğ‘¤22 = (ğ‘£22/ğ‘£21 - ğ‘¤12);
    var ğ‘¤23 = (ğ‘£23/ğ‘£21 - ğ‘¤13);
    var ğ‘¤24 = (ğ‘£24/ğ‘£21 - ğ‘¤14);

    var ğ‘ƒ = (-ğ‘¤23 / ğ‘¤22);
    var ğ‘„ = (ğ‘¤24 / ğ‘¤22);
    var ğ‘€ = ((-ğ‘¤12)*ğ‘ƒ - ğ‘¤13);
    var ğ‘ = (ğ‘¤14 - ğ‘¤12*ğ‘„);

    var ğ‘ = (ğ‘**2 + ğ‘„**2 - 1);
    var ğ‘ = (2*ğ‘€*ğ‘ - 2*ğ‘*c[0].x + 2*ğ‘ƒ*ğ‘„ - 2*ğ‘„*c[0].y + 2*s[0]*c[0].r);
    var ğ‘ = (c[0].x**2 + ğ‘€**2 - 2*ğ‘€*c[0].x + ğ‘ƒ**2 + c[0].y**2 - 2*ğ‘ƒ*c[0].y - c[0].r**2);

    var ğ· = (ğ‘**2 - 4*ğ‘*ğ‘);
    var rs = ((-ğ‘ - ğ·.sqrt) / 2*ğ‘);

    var xs = (ğ‘€ + ğ‘*rs);
    var ys = (ğ‘ƒ + ğ‘„*rs);

    Circle(xs, ys, rs);
}

var c = [Circle(0, 0, 1), Circle(4, 0, 1), Circle(2, 4, 2)];

var a = solve_apollonius(c, %n<1 1 1>);
var b = solve_apollonius(c, %n<-1 -1 -1>);

say a;
say b;

a.x == 2     || die "error";
a.y == 21/10 || die "error";
a.r == 39/10 || die "error";
b.x == 2     || die "error";
b.r == 7/6   || die "error";
